#!/usr/bin/env bash

set -euo pipefail

cd "$(dirname "$(readlink -f "$0")")"
self=$0

create_pdf() {
    pandoc \
        --from=markdown+fenced_code_blocks+fenced_code_attributes+tex_math_dollars \
        --to beamer \
        --pdf-engine=xelatex \
        --variable fontsize=9pt \
        -o slides.pdf
}


pdf_input() {
    echo "# These slides were generated by very good and reasonable code"
    echo '\fontsize{4pt}{3}\selectfont'
    echo
    echo '```bash'
    cat "$self"
    echo '```'



find tools -type f | python3 <(cat <<'EOF'
import sys
import random

essentials = []
nice_to_have = []
for filename in sys.stdin.read().split('\n'):
    try:
        with open(filename, 'r') as file:
            if "essential" in filename:
                essentials.append((filename, file.read()))
            else:
                nice_to_have.append((filename, file.read()))
    except FileNotFoundError:
        pass

pdf_input_content = []
for (filename, contents) in essentials:
    pdf_input_content.append(f'<!-- File: {filename} -->\n\n{contents}')
random.shuffle(nice_to_have)
for (filename, contents) in nice_to_have:
    pdf_input_content.append(f'<!-- File: {filename} -->\n\n{contents}')

print('\n\n\n\n\n'.join(pdf_input_content))
EOF
)
}

echo "Shuffling slides" >&2
pdf_input | tee 'slides.md' | create_pdf
echo "Done! Have fun" >&2
